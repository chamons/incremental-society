@page "/"
@using System.Threading;
@using IncrementalSociety.Web.Services

@inject GameService GameService


<div class="container-fluid">
	<div class="row">

		<div class="col-4">
			<div id="resources">
				<ResourceView />
			</div>
			<div id="actions">
				<ActionsView />
			</div>
			<div id="conversions">
				<ConversionsView />
			</div>

		</div>
		<div class="col">
			<div id="regions">
				@foreach (var region in @GameService.Regions)
				{
					<div class="region">
						<p>@region.Name</p>
						<div class="region-areas d-flex flex-row flex-wrap">
							@for (int i = 0; i < region.Areas.Length; ++i)
							{
								string areaInfoID = region.Name + i.ToString ();
								<AreaView area="@region.Areas[i]"  />
							}
						</div>
					</div>
				}
				<BuildingSelectModal />
			</div>
		</div>
	</div>
</div>

@functions {


	protected override void OnInit ()
	{
		GameService.CurrentUIStateChanged += (o, e) => StateHasChanged ();
		StartTickTimer ();
	}

	void StartTickTimer ()
	{
		var timer = new Timer (new TimerCallback (_ =>
		{
			GameService.OnTick ();
		}), null, 1000, 1000);
	}
}
