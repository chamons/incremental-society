@using System.Collections.Immutable
@using IncrementalSociety.Web.Services
@using IncrementalSociety.Utilities

@inject GameService GameService
@inject StyleService StyleService

<div>
	<div class="d-flex flex-column building @BuildingStyleClass" onclick=@OnClick>
		<p class="building-title">@BuildingName</p>
		@if (HasBuilding) {
			<MiniResourcesView
				Resources="@Resources"
				ColorResourcesAsDelta="@ColorResourcesAsDelta" />
			<MiniResourcesView
				AdditionalStyles="secondary-resources"
				Resources="@SecondaryResources"
				ColorResourcesAsDelta="@ColorResourcesAsDelta" />
			@foreach (var conversion in Conversions.AsNotNull ()) {
				<MiniResourcesView
					AdditionalStyles="@ConversionClass(conversion.Enabled)"
					Resources="@conversion.Resources"
					ColorResourcesAsDelta="@ColorResourcesAsDelta" />
			}
		}
	</div>
</div>

@functions {
	[Parameter]
	string BuildingName { get; set; }

	[Parameter]
	Resources Resources { get; set; }

	[Parameter]
	List<(bool Enabled, Resources Resources)> Conversions { get; set; }

	[Parameter]
	Resources SecondaryResources { get; set; }

	[Parameter]
	bool Disabled { get; set; }

	[Parameter]
	Action OnClick { get; set; }

	[Parameter]
	bool ColorResourcesAsDelta { get; set; }

	bool HasBuilding => !String.IsNullOrEmpty (BuildingName);
	string GetResourceValueClass (double value) => ColorResourcesAsDelta ? StyleService.GetResourceDeltaClass (value) : "";
	string ConversionClass (bool enabled) => enabled ? "conversion-enabled" : "conversion-disabled";
	string BuildingStyleClass => Disabled ? "disabled" : "";

	protected override void OnInit ()
	{
		GameService.CurrentUIStateChanged += (o, e) => StateHasChanged ();
	}
}
